"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics_textbook=globalThis.webpackChunkphysical_ai_humanoid_robotics_textbook||[]).push([[8927],{8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var i=s(6540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}},9030:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"module-1/ros2-nodes-topics-services","title":"ROS 2 Fundamentals: Nodes, Topics, and Services","description":"Introduction to the Robotic Nervous System","source":"@site/docs/module-1/ros2-nodes-topics-services.md","sourceDirName":"module-1","slug":"/module-1/ros2-nodes-topics-services","permalink":"/docs/module-1/ros2-nodes-topics-services","draft":false,"unlisted":false,"editUrl":"https://github.com/SyedAbdulSami1/Physical-AI-Humanoid-Robotics-Textbook/tree/main/docs/module-1/ros2-nodes-topics-services.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Module 1: The Robotic Nervous System (ROS 2)","permalink":"/docs/category/module-1-the-robotic-nervous-system-ros-2"},"next":{"title":"Bridging Python Agents to ROS 2 Controllers with rclpy","permalink":"/docs/module-1/bridging-python-agents-to-ros2"}}');var r=s(4848),t=s(8453);const l={},o="ROS 2 Fundamentals: Nodes, Topics, and Services",c={},a=[{value:"Introduction to the Robotic Nervous System",id:"introduction-to-the-robotic-nervous-system",level:2},{value:"The Architecture of ROS 2",id:"the-architecture-of-ros-2",level:2},{value:"Nodes: The Workers of ROS 2",id:"nodes-the-workers-of-ros-2",level:2},{value:"Creating Your First ROS 2 Node (Python/rclpy)",id:"creating-your-first-ros-2-node-pythonrclpy",level:3},{value:"Topics: The Asynchronous Data Streams",id:"topics-the-asynchronous-data-streams",level:2},{value:"Lab 1.2: Implementing a Talker and Listener (Python/rclpy)",id:"lab-12-implementing-a-talker-and-listener-pythonrclpy",level:3},{value:"Inspecting Topics",id:"inspecting-topics",level:3},{value:"Services: The Synchronous Request-Response",id:"services-the-synchronous-request-response",level:2},{value:"Lab 1.3: Implementing a Simple Adder Service (Python/rclpy)",id:"lab-13-implementing-a-simple-adder-service-pythonrclpy",level:3},{value:"Inspecting Services",id:"inspecting-services",level:3},{value:"Actions: The Long-Running Goal-Feedback-Result",id:"actions-the-long-running-goal-feedback-result",level:2},{value:"Lab 1.4: Implementing a Fibonacci Action (Python/rclpy)",id:"lab-14-implementing-a-fibonacci-action-pythonrclpy",level:3},{value:"Inter-Process Communication (IPC) Summary",id:"inter-process-communication-ipc-summary",level:2},{value:"Student Exercises",id:"student-exercises",level:2},{value:"Further Reading and Official Resources",id:"further-reading-and-official-resources",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"ros-2-fundamentals-nodes-topics-and-services",children:"ROS 2 Fundamentals: Nodes, Topics, and Services"})}),"\n",(0,r.jsx)(n.h2,{id:"introduction-to-the-robotic-nervous-system",children:"Introduction to the Robotic Nervous System"}),"\n",(0,r.jsx)(n.p,{children:'The Robotic Operating System 2 (ROS 2) provides a flexible framework for writing robot software, serving as the sophisticated "nervous system" for modern robotics. As an indispensable middleware in Physical AI, it enables modular design and efficient communication between components, crucial for achieving complex robotic behaviors. This chapter focuses on ROS 2\'s core communication primitives: Nodes, Topics, and Services, fundamental for developing any robotic system, especially humanoid robots requiring intricate coordination.'}),"\n",(0,r.jsx)(n.h2,{id:"the-architecture-of-ros-2",children:"The Architecture of ROS 2"}),"\n",(0,r.jsx)(n.p,{children:"ROS 2 is designed for distributed, loosely coupled systems, leveraging a DDS (Data Distribution Service) layer for direct peer-to-peer communication. This architecture enhances reliability, scalability, and supports real-time capabilities essential for critical applications like humanoid control, differentiating it from its predecessor, ROS 1, which used a central master."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    A[Node A: Perception] --\x3e|/camera/image_raw| B(Node B: Object Detection)\n    B --\x3e|/object/detections| C{Node C: Path Planning}\n    C --\x3e|/robot/cmd_vel| D[Node D: Motor Control]\n    E[Node E: UI Interface] -- SERVICE REQUEST --\x3e F[Node F: Task Manager]\n    F -- SERVICE RESPONSE --\x3e E\n    D -- FEEDBACK --\x3e G[Node G: Odometry]\n    G --\x3e C\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Figure 1.1: Simplified ROS 2 communication graph illustrating nodes, topics, and services."})}),"\n",(0,r.jsx)(n.h2,{id:"nodes-the-workers-of-ros-2",children:"Nodes: The Workers of ROS 2"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"node"})," in ROS 2 is an executable program performing a specific task, acting as a focused process within the robotic system. For a humanoid robot, nodes can be dedicated to perception, navigation, manipulation, motor control, or high-level AI tasks. This modularity facilitates easier development, debugging, and software reuse. Should one node fail, the system can often continue operating or fail gracefully."]}),"\n",(0,r.jsx)(n.h3,{id:"creating-your-first-ros-2-node-pythonrclpy",children:"Creating Your First ROS 2 Node (Python/rclpy)"}),"\n",(0,r.jsx)(n.p,{children:'Let\'s start by creating a simple "talker" node that publishes a message and a "listener" node that subscribes to it.'}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Lab 1.1: Setting Up Your ROS 2 Workspace and First Node"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Goal"}),': Create a ROS 2 workspace and a basic Python node that prints "Hello, ROS 2!".']}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Open a Terminal"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure your ROS 2 environment is sourced. For example, ",(0,r.jsx)(n.code,{children:"source /opt/ros/humble/setup.bash"})," (replace ",(0,r.jsx)(n.code,{children:"humble"})," with your ROS 2 distribution)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create a Workspace"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src\ncd ~/ros2_ws/src\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create a ROS 2 Package"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 pkg create --build-type ament_python my_robot_pkg --dependencies rclpy\n"})}),"\n","This creates a Python package named ",(0,r.jsx)(n.code,{children:"my_robot_pkg"})," with ",(0,r.jsx)(n.code,{children:"rclpy"})," (the Python client library for ROS 2) as a dependency."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create the Python Node File"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"touch ~/ros2_ws/src/my_robot_pkg/my_robot_pkg/simple_node.py\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Edit ",(0,r.jsx)(n.code,{children:"simple_node.py"})]}),":\nAdd the following Python code to ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_pkg/my_robot_pkg/simple_node.py"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass SimpleNode(Node):\n\n    def __init__(self):\n        super().__init__('simple_node')\n        self.get_logger().info('Hello, ROS 2! From SimpleNode.')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    simple_node = SimpleNode()\n    rclpy.spin(simple_node) # Keep node alive until Ctrl+C\n    simple_node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Update ",(0,r.jsx)(n.code,{children:"setup.py"})]}),":\nEdit ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_pkg/setup.py"})," to add an entry point for your executable. Locate the ",(0,r.jsx)(n.code,{children:"entry_points"})," dictionary and add the following:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'simple_node = my_robot_pkg.simple_node:main',\n    ],\n},\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build Your Workspace"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Source Your Workspace"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Run Your Node"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_pkg simple_node\n"})}),"\n","You should see ",(0,r.jsx)(n.code,{children:"[INFO] [simple_node]: Hello, ROS 2! From SimpleNode."})," in your terminal."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common Pitfall"}),": Forgetting to source your workspace (",(0,r.jsx)(n.code,{children:"source install/setup.bash"}),") after building.\n",(0,r.jsx)(n.strong,{children:"Fix"}),": Always source after building new packages or opening a new terminal."]}),"\n",(0,r.jsx)(n.h2,{id:"topics-the-asynchronous-data-streams",children:"Topics: The Asynchronous Data Streams"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Topics"}),' are the most common communication mechanism in ROS 2, utilizing a publish-subscribe model for continuous, asynchronous data streams. A node "publishes" messages to a named topic, and interested nodes "subscribe" to it. Each topic has a specific message type, ensuring data integrity. This model is ideal for sensor data, robot state, and low-level control commands.']}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Publisher"}),": Sends messages to a topic."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Subscriber"}),": Receives messages from a topic."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Message Type"}),": Defines the structure of transmitted data (e.g., ",(0,r.jsx)(n.code,{children:"std_msgs/msg/String"}),"), ensuring type safety."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    A[Lidar Sensor Node] -- Publishes [/scan] (sensor_msgs/LaserScan) --\x3e B(Navigation Node)\n    C[Camera Node] -- Publishes [/camera/image_raw] (sensor_msgs/Image) --\x3e D(Perception Node)\n    D --\x3e E[Object Detector Node] -- Publishes [/objects] (custom_msgs/ObjectDetection) --\x3e B\n    B --\x3e F[Path Planner Node] -- Publishes [/cmd_vel] (geometry_msgs/Twist) --\x3e G(Base Controller Node)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Figure 1.2: Example of ROS 2 topics in a mobile robot system."})}),"\n",(0,r.jsx)(n.h3,{id:"lab-12-implementing-a-talker-and-listener-pythonrclpy",children:"Lab 1.2: Implementing a Talker and Listener (Python/rclpy)"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Navigate to your package"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src/my_robot_pkg/my_robot_pkg\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Create ",(0,r.jsx)(n.code,{children:"talker.py"})]}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String # Standard string message type\n\nclass TalkerNode(Node):\n    def __init__(self):\n        super().__init__('talker_node')\n        # Create a publisher on the 'chatter' topic with String messages\n        # and a queue size of 10\n        self.publisher_ = self.create_publisher(String, 'chatter', 10)\n        self.i = 0\n        # Create a timer to publish messages every 0.5 seconds\n        timer_period = 0.5\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.get_logger().info('Talker node has started and is publishing...')\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = f'Hello, world! {self.i}'\n        self.publisher_.publish(msg)\n        self.get_logger().info(f'Publishing: \"{msg.data}\"')\n        self.i += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    talker_node = TalkerNode()\n    try:\n        rclpy.spin(talker_node)\n    except KeyboardInterrupt:\n        pass\n    talker_node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Create ",(0,r.jsx)(n.code,{children:"listener.py"})]}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass ListenerNode(Node):\n    def __init__(self):\n        super().__init__('listener_node')\n        # Create a subscriber to the 'chatter' topic with String messages\n        self.subscription = self.create_subscription(\n            String,\n            'chatter',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n        self.get_logger().info('Listener node has started and is subscribing...')\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'I heard: \"{msg.data}\"')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    listener_node = ListenerNode()\n    try:\n        rclpy.spin(listener_node)\n    except KeyboardInterrupt:\n        pass\n    listener_node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Update ",(0,r.jsx)(n.code,{children:"setup.py"})]}),":\nAdd entry points for both ",(0,r.jsx)(n.code,{children:"talker.py"})," and ",(0,r.jsx)(n.code,{children:"listener.py"})," in ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_pkg/setup.py"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'simple_node = my_robot_pkg.simple_node:main', # Keep existing\n        'talker = my_robot_pkg.talker:main',\n        'listener = my_robot_pkg.listener:main',\n    ],\n},\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build and Source"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build\nsource install/setup.bash\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Run in Separate Terminals"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Terminal 1: ",(0,r.jsx)(n.code,{children:"ros2 run my_robot_pkg talker"})]}),"\n",(0,r.jsxs)(n.li,{children:["Terminal 2: ",(0,r.jsx)(n.code,{children:"ros2 run my_robot_pkg listener"}),"\nYou should see the listener printing the messages published by the talker."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common Pitfall"}),": Incorrect topic name or message type between publisher and subscriber.\n",(0,r.jsx)(n.strong,{children:"Fix"}),": Use ",(0,r.jsx)(n.code,{children:"ros2 topic list -t"})," to inspect active topics and their types. Ensure they match."]}),"\n",(0,r.jsx)(n.h3,{id:"inspecting-topics",children:"Inspecting Topics"}),"\n",(0,r.jsx)(n.p,{children:"ROS 2 provides command-line tools to interact with and debug topics:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 topic list"}),": Lists all active topics."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 topic info <topic_name>"}),": Shows publishers, subscribers, and message type for a topic."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 topic echo <topic_name>"}),": Displays messages being published on a topic in real-time."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 interface show <message_type>"}),": Shows the definition of a message type."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"services-the-synchronous-request-response",children:"Services: The Synchronous Request-Response"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Services"}),' implement a synchronous request-response communication model, akin to a distributed function call. A client node sends a request to a server node and awaits an immediate response. This is suitable for single, immediate tasks that don\'t involve continuous data streams. Examples include configuring robot modes, querying status, or triggering discrete actions like "open gripper." Each service type specifies the structure for both its request and response messages.']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    A[Client Node: UI Command] -- SERVICE REQUEST (SetMode.srv) --\x3e B(Server Node: Robot Controller)\n    B -- Processes Command --\x3e B\n    B -- SERVICE RESPONSE (ModeSetAck) --\x3e A\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Figure 1.3: ROS 2 service communication flow."})}),"\n",(0,r.jsx)(n.h3,{id:"lab-13-implementing-a-simple-adder-service-pythonrclpy",children:"Lab 1.3: Implementing a Simple Adder Service (Python/rclpy)"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Define a Custom Service Type"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["In ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_pkg"}),", create a ",(0,r.jsx)(n.code,{children:"srv"})," directory:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src/my_robot_pkg/srv\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Create ",(0,r.jsx)(n.code,{children:"AddTwoInts.srv"})," inside the ",(0,r.jsx)(n.code,{children:"srv"})," directory:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Request\nint64 a\nint64 b\n---\n# Response\nint64 sum\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Edit ",(0,r.jsx)(n.code,{children:"setup.py"})]}),":\nTo make ROS 2 aware of your custom service, modify ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_pkg/setup.py"}),".\nFirst, ensure ",(0,r.jsx)(n.code,{children:"setuptools"})," and ",(0,r.jsx)(n.code,{children:"ament_cmake_auto"})," are in ",(0,r.jsx)(n.code,{children:"install_requires"})," (they usually are by default, but double-check).\nThen, add ",(0,r.jsx)(n.code,{children:"message_generation"})," to ",(0,r.jsx)(n.code,{children:"package_data"})," and ensure ",(0,r.jsx)(n.code,{children:"AddTwoInts.srv"})," is listed:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# ... other imports\nfrom setuptools import setup\nimport os\nfrom glob import glob\n\npackage_name = 'my_robot_pkg'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=[package_name],\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        (os.path.join('share', package_name, 'launch'), glob(os.path.join('launch', '*launch.[pxy][yem]'))),\n        (os.path.join('share', package_name, 'srv'), glob('srv/*.srv')) # Add this line\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='your_name',\n    maintainer_email='your_email@example.com',\n    description='TODO: Package description',\n    license='TODO: License declaration',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'simple_node = my_robot_pkg.simple_node:main',\n            'talker = my_robot_pkg.talker:main',\n            'listener = my_robot_pkg.listener:main',\n            'add_server = my_robot_pkg.add_two_ints_server:main', # New server entry point\n            'add_client = my_robot_pkg.add_two_ints_client:main', # New client entry point\n        ],\n    },\n)\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Edit ",(0,r.jsx)(n.code,{children:"package.xml"})]}),":\nAdd the following build and execution dependencies to ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_pkg/package.xml"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<build_depend>rosidl_default_generators</build_depend>\n<exec_depend>rosidl_default_runtime</exec_depend>\n<member_of_group>rosidl_interface_packages</member_of_group>\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Create ",(0,r.jsx)(n.code,{children:"add_two_ints_server.py"})]}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom my_robot_pkg.srv import AddTwoInts # Import your custom service type\n\nclass AddTwoIntsService(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n        self.get_logger().info('Add two ints service ready.')\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Incoming request: a={request.a}, b={request.b}')\n        self.get_logger().info(f'Sending response: sum={response.sum}')\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    add_two_ints_service = AddTwoIntsService()\n    try:\n        rclpy.spin(add_two_ints_service)\n    except KeyboardInterrupt:\n        pass\n    add_two_ints_service.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Create ",(0,r.jsx)(n.code,{children:"add_two_ints_client.py"})]}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import sys\nimport rclpy\nfrom rclpy.node import Node\nfrom rclpy.task import Future\nfrom my_robot_pkg.srv import AddTwoInts\n\nclass AddTwoIntsClient(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        # Wait for the service to be available\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n        self.get_logger().info('Add two ints client ready.')\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        self.get_logger().info(f'Requesting sum of {a} and {b}...')\n        return self.future\n\ndef main(args=None):\n    rclpy.init(args=args)\n    add_two_ints_client = AddTwoIntsClient()\n\n    if len(sys.argv) != 3:\n        add_two_ints_client.get_logger().info('Usage: ros2 run my_robot_pkg add_client <int> <int>')\n        return\n\n    a = int(sys.argv[1])\n    b = int(sys.argv[2])\n\n    future = add_two_ints_client.send_request(a, b)\n\n    # Wait for the response\n    rclpy.spin_until_future_complete(add_two_ints_client, future)\n\n    if future.result() is not None:\n        add_two_ints_client.get_logger().info(f'Result of add_two_ints: {future.result().sum}')\n    else:\n        add_two_ints_client.get_logger().error(f'Service call failed {future.exception()}')\n\n    add_two_ints_client.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Build and Source"}),":\nThis is crucial after adding a custom service type!"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build\nsource install/setup.bash\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Run in Separate Terminals"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Terminal 1: ",(0,r.jsx)(n.code,{children:"ros2 run my_robot_pkg add_server"})]}),"\n",(0,r.jsxs)(n.li,{children:["Terminal 2: ",(0,r.jsx)(n.code,{children:"ros2 run my_robot_pkg add_client 5 7"}),"\nThe client should print ",(0,r.jsx)(n.code,{children:"Result of add_two_ints: 12"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common Pitfall"}),": Not rebuilding after adding or modifying ",(0,r.jsx)(n.code,{children:".srv"})," files, or forgetting to add ",(0,r.jsx)(n.code,{children:"rosidl_default_generators"})," dependencies to ",(0,r.jsx)(n.code,{children:"package.xml"})," and ",(0,r.jsx)(n.code,{children:"setup.py"}),".\n",(0,r.jsx)(n.strong,{children:"Fix"}),": Always ",(0,r.jsx)(n.code,{children:"colcon build"})," and ",(0,r.jsx)(n.code,{children:"source install/setup.bash"})," after any changes to interface definition files (messages, services, actions)."]}),"\n",(0,r.jsx)(n.h3,{id:"inspecting-services",children:"Inspecting Services"}),"\n",(0,r.jsx)(n.p,{children:"Similar to topics, ROS 2 provides command-line tools for services:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 service list"}),": Lists all active services."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 service type <service_name>"}),": Shows the service type."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 service find <service_type>"}),": Finds services of a specific type."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 service call <service_name> <service_type> <arguments>"}),": Calls a service from the command line."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Example using ",(0,r.jsx)(n.code,{children:"ros2 service call"})]}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ros2 service call /add_two_ints my_robot_pkg/srv/AddTwoInts "{a: 10, b: 20}"\n'})}),"\n",(0,r.jsx)(n.p,{children:"This should return:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"requester:\n  qos_profile:\n    depth: 10\n    durability: 1\n    history: 2\n    reliability: 1\nresponse:\n  sum: 30\n"})}),"\n",(0,r.jsx)(n.h2,{id:"actions-the-long-running-goal-feedback-result",children:"Actions: The Long-Running Goal-Feedback-Result"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Actions"})," extend the request-response model for long-running, preemptable tasks. A client sends a goal, receives continuous feedback during execution, and eventually gets a final result. Critically, clients can cancel a goal mid-execution. This makes actions ideal for tasks like navigation or manipulation sequences that require ongoing execution and status updates. An action definition comprises a ",(0,r.jsx)(n.strong,{children:"Goal"})," (desired outcome), ",(0,r.jsx)(n.strong,{children:"Result"})," (final outcome), and ",(0,r.jsx)(n.strong,{children:"Feedback"})," (progress updates)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    subgraph Action Client\n        A[Goal Request] --\x3e B(Action Server)\n        B --\x3e|Feedback| C[Feedback Stream]\n        B --\x3e|Result| D[Result Return]\n        C --\x3e A\n        D --\x3e A\n    end\n    subgraph Action Server\n        B\n        E[Preempt/Cancel] --\x3e B\n    end\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Figure 1.4: ROS 2 action communication model."})}),"\n",(0,r.jsx)(n.h3,{id:"lab-14-implementing-a-fibonacci-action-pythonrclpy",children:"Lab 1.4: Implementing a Fibonacci Action (Python/rclpy)"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Define a Custom Action Type"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["In ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_pkg"}),", create an ",(0,r.jsx)(n.code,{children:"action"})," directory:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src/my_robot_pkg/action\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Create ",(0,r.jsx)(n.code,{children:"Fibonacci.action"})," inside the ",(0,r.jsx)(n.code,{children:"action"})," directory:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Goal\nint32 order\n---\n# Result\nint32[] sequence\n---\n# Feedback\nint32[] partial_sequence\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Edit ",(0,r.jsx)(n.code,{children:"setup.py"})]}),":\nSimilar to services, add ",(0,r.jsx)(n.code,{children:"action"})," directory to ",(0,r.jsx)(n.code,{children:"package_data"})," and ensure ",(0,r.jsx)(n.code,{children:"Fibonacci.action"})," is listed:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# ... existing setup.py\n    data_files=[\n        # ... existing data_files\n        (os.path.join('share', package_name, 'action'), glob('action/*.action')) # Add this line\n    ],\n    install_requires=['setuptools', 'rclpy', 'action_msgs', 'builtin_interfaces'], # Add action_msgs, builtin_interfaces\n    # ... other setup options\n    entry_points={\n        'console_scripts': [\n            # ... existing entry points\n            'fibonacci_server = my_robot_pkg.fibonacci_action_server:main', # New\n            'fibonacci_client = my_robot_pkg.fibonacci_action_client:main', # New\n        ],\n    },\n)\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Edit ",(0,r.jsx)(n.code,{children:"package.xml"})]}),":\nAdd dependencies for actions:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<build_depend>rosidl_default_generators</build_depend>\n<exec_depend>rosidl_default_runtime</exec_depend>\n<build_depend>action_msgs</build_depend>\n<exec_depend>action_msgs</exec_depend>\n<member_of_group>rosidl_interface_packages</member_of_group>\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Create ",(0,r.jsx)(n.code,{children:"fibonacci_action_server.py"})]}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import time\nimport rclpy\nfrom rclpy.action import ActionServer, GoalStatus\nfrom rclpy.node import Node\nfrom my_robot_pkg.action import Fibonacci # Import your custom action type\n\nclass FibonacciActionServer(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            self.execute_callback,\n            goal_done_callback=self.goal_done_callback\n        )\n        self.get_logger().info('Fibonacci action server ready.')\n\n    def goal_done_callback(self, goal_handle):\n        self.get_logger().info(f'Goal was done: {goal_handle.get_status_as_result()}')\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info(f'Executing goal: {goal_handle.request.order}')\n\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.partial_sequence = [0, 1]\n\n        # Append the Fibonacci sequence to the feedback message\n        for i in range(1, goal_handle.request.order):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n\n            feedback_msg.partial_sequence.append(\n                feedback_msg.partial_sequence[i] + feedback_msg.partial_sequence[i-1]\n            )\n            self.get_logger().info(f'Feedback: {feedback_msg.partial_sequence}')\n            goal_handle.publish_feedback(feedback_msg)\n            time.sleep(0.5) # Simulate work\n\n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.partial_sequence\n        self.get_logger().info(f'Goal succeeded, result: {result.sequence}')\n        return result\n\ndef main(args=None):\n    rclpy.init(args=args)\n    fibonacci_action_server = FibonacciActionServer()\n    try:\n        rclpy.spin(fibonacci_action_server)\n    except KeyboardInterrupt:\n        pass\n    fibonacci_action_server.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Create ",(0,r.jsx)(n.code,{children:"fibonacci_action_client.py"})]}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom my_robot_pkg.action import Fibonacci\n\nclass FibonacciActionClient(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_client')\n        self._action_client = ActionClient(self, Fibonacci, 'fibonacci')\n        self.get_logger().info('Fibonacci action client ready.')\n\n    def send_goal(self, order):\n        self.get_logger().info('Waiting for action server...')\n        self._action_client.wait_for_server()\n\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        self.get_logger().info(f'Sending goal request... order={order}')\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().error('Goal rejected :(')\n            return\n\n        self.get_logger().info('Goal accepted :)')\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        status = future.result().status\n        if status == GoalStatus.STATUS_SUCCEEDED:\n            self.get_logger().info(f'Goal succeeded! Result: {list(result.sequence)}')\n        else:\n            self.get_logger().warn(f'Goal failed with status: {status}')\n        rclpy.shutdown() # Shutdown client after receiving result\n\n    def feedback_callback(self, feedback_msg):\n        self.get_logger().info(f'Received feedback: {list(feedback_msg.partial_sequence)}')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    action_client = FibonacciActionClient()\n    action_client.send_goal(10) # Request Fibonacci sequence up to order 10\n    rclpy.spin(action_client) # Keep client alive to receive feedback and result\n    # Note: rclpy.shutdown() is called in get_result_callback\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Build and Source"}),":\nAgain, crucial after adding a custom action type!"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build\nsource install/setup.bash\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Run in Separate Terminals"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Terminal 1: ",(0,r.jsx)(n.code,{children:"ros2 run my_robot_pkg fibonacci_server"})]}),"\n",(0,r.jsxs)(n.li,{children:["Terminal 2: ",(0,r.jsx)(n.code,{children:"ros2 run my_robot_pkg fibonacci_client"}),"\nYou should observe the client receiving feedback periodically and then the final result."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common Pitfall"}),": Not including ",(0,r.jsx)(n.code,{children:"action_msgs"})," and ",(0,r.jsx)(n.code,{children:"builtin_interfaces"})," in ",(0,r.jsx)(n.code,{children:"install_requires"})," in ",(0,r.jsx)(n.code,{children:"setup.py"})," and ",(0,r.jsx)(n.code,{children:"package.xml"}),".\n",(0,r.jsx)(n.strong,{children:"Fix"}),": Always include these dependencies when working with ROS 2 actions."]}),"\n",(0,r.jsx)(n.h2,{id:"inter-process-communication-ipc-summary",children:"Inter-Process Communication (IPC) Summary"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Feature"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Communication Model"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Use Case"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Synchronous/Asynchronous"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Preemptable"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Example Messages/Requests/Goals"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"Nodes"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Executable unit"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Encapsulate specific robot functionality"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"N/A"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"N/A"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"N/A"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"Topics"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Publish-Subscribe"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Continuous data streams (sensors, odometry, cmd_vel)"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Asynchronous"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.code,{children:"sensor_msgs/Image"}),", ",(0,r.jsx)(n.code,{children:"geometry_msgs/Twist"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"Services"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Request-Response"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Single, immediate requests for computation/action"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Synchronous"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.code,{children:"std_srvs/Trigger"}),", ",(0,r.jsx)(n.code,{children:"my_robot_pkg/AddTwoInts"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"Actions"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Goal-Feedback-Result"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Long-running, preemptable tasks"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Asynchronous (client side)"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Yes"}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.code,{children:"nav2_msgs/NavigateToPose"}),", ",(0,r.jsx)(n.code,{children:"my_robot_pkg/Fibonacci"})]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"student-exercises",children:"Student Exercises"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Exercise 1.1: Topic Remapping"}),"\nModify the ",(0,r.jsx)(n.code,{children:"talker"})," and ",(0,r.jsx)(n.code,{children:"listener"})," nodes. Remap the ",(0,r.jsx)(n.code,{children:"chatter"})," topic of the ",(0,r.jsx)(n.code,{children:"talker"})," node to ",(0,r.jsx)(n.code,{children:"/robot/status_updates"})," using a ROS 2 launch file. Ensure the ",(0,r.jsx)(n.code,{children:"listener"})," node still receives messages by subscribing to the remapped topic."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:"Hint"}),": Explore ",(0,r.jsx)(n.code,{children:"ros2 launch"})," XML or Python syntax for remapping."]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Solution (click to expand)"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"my_robot_pkg/launch/remap_talker.launch.py"})}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from launch import LaunchDescription\nfrom launch_ros.actions import Node\n\ndef generate_launch_description():\n    return LaunchDescription([\n        Node(\n            package='my_robot_pkg',\n            executable='talker',\n            name='my_remapped_talker',\n            remappings=[\n                ('chatter', '/robot/status_updates')\n            ]\n        ),\n        Node(\n            package='my_robot_pkg',\n            executable='listener',\n            name='my_listener',\n            # Listener will automatically subscribe to the remapped topic if it's the only one\n            # or you can explicitly remap its subscription as well:\n            # remappings=[\n            #     ('chatter', '/robot/status_updates')\n            # ]\n        )\n    ])\n"})}),(0,r.jsxs)(n.p,{children:["Run with: ",(0,r.jsx)(n.code,{children:"ros2 launch my_robot_pkg remap_talker.launch.py"}),"\nThe listener will hear messages on ",(0,r.jsx)(n.code,{children:"/robot/status_updates"})," which the talker is publishing to."]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Exercise 1.2: Advanced Service Call"}),"\nCreate a new service client that takes three integer arguments (",(0,r.jsx)(n.code,{children:"a"}),", ",(0,r.jsx)(n.code,{children:"b"}),", ",(0,r.jsx)(n.code,{children:"c"}),") and calls the ",(0,r.jsx)(n.code,{children:"add_two_ints"})," service twice: first to add ",(0,r.jsx)(n.code,{children:"a"})," and ",(0,r.jsx)(n.code,{children:"b"}),", then to add the result to ",(0,r.jsx)(n.code,{children:"c"}),". Print the final sum."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:"Hint"}),": Remember that service calls are synchronous by default in ",(0,r.jsx)(n.code,{children:"rclpy"}),"'s client. You can make two consecutive calls."]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Solution (click to expand)"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"my_robot_pkg/my_robot_pkg/add_three_ints_client.py"})}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import sys\nimport rclpy\nfrom rclpy.node import Node\nfrom my_robot_pkg.srv import AddTwoInts\n\nclass AddThreeIntsClient(Node):\n    def __init__(self):\n        super().__init__('add_three_ints_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('add_two_ints service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n        self.get_logger().info('Add three ints client ready.')\n\n    def send_request(self, a, b, c):\n        # First call: a + b\n        self.req.a = a\n        self.req.b = b\n        self.get_logger().info(f'Requesting sum of {a} and {b}...')\n        future1 = self.cli.call(self.req) # Synchronous call\n\n        if future1.sum is not None:\n            intermediate_sum = future1.sum\n            self.get_logger().info(f'Intermediate sum: {intermediate_sum}')\n\n            # Second call: (a + b) + c\n            self.req.a = intermediate_sum\n            self.req.b = c\n            self.get_logger().info(f'Requesting sum of {intermediate_sum} and {c}...')\n            future2 = self.cli.call(self.req) # Synchronous call\n\n            if future2.sum is not None:\n                final_sum = future2.sum\n                self.get_logger().info(f'Final sum of {a}, {b}, and {c}: {final_sum}')\n            else:\n                self.get_logger().error(f'Second service call failed!')\n        else:\n            self.get_logger().error(f'First service call failed!')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    add_three_ints_client = AddThreeIntsClient()\n\n    if len(sys.argv) != 4:\n        add_three_ints_client.get_logger().info('Usage: ros2 run my_robot_pkg add_three_ints_client <int> <int> <int>')\n        return\n\n    a = int(sys.argv[1])\n    b = int(sys.argv[2])\n    c = int(sys.argv[3])\n\n    add_three_ints_client.send_request(a, b, c)\n\n    add_three_ints_client.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),(0,r.jsxs)(n.p,{children:["Add to ",(0,r.jsx)(n.code,{children:"setup.py"})," ",(0,r.jsx)(n.code,{children:"console_scripts"}),":\n",(0,r.jsx)(n.code,{children:"'add_three_ints_client = my_robot_pkg.add_three_ints_client:main',"}),"\nRun with: ",(0,r.jsx)(n.code,{children:"ros2 run my_robot_pkg add_server"})," (in one terminal) and ",(0,r.jsx)(n.code,{children:"ros2 run my_robot_pkg add_three_ints_client 1 2 3"})," (in another)"]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Exercise 1.3: Action Preemption"}),"\nModify the Fibonacci action client to send a goal with order 20, but then cancel the goal after receiving 3-5 feedback messages. Observe the server's response."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:"Hint"}),": Use ",(0,r.jsx)(n.code,{children:"rclpy.timer.Timer"})," or ",(0,r.jsx)(n.code,{children:"time.sleep"})," in the client to wait for some feedback, then call ",(0,r.jsx)(n.code,{children:"goal_handle.cancel_goal_async()"}),"."]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Solution (click to expand)"}),(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Modified ",(0,r.jsx)(n.code,{children:"fibonacci_action_client.py"})]}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom my_robot_pkg.action import Fibonacci\nfrom rclpy.task import Future\nimport threading\nimport time # For simulating a delay before cancellation\n\nclass FibonacciActionClient(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_client')\n        self._action_client = ActionClient(self, Fibonacci, 'fibonacci')\n        self.get_logger().info('Fibonacci action client ready.')\n        self.goal_handle = None\n        self.feedback_count = 0\n        self.cancellation_timer = None\n\n    def send_goal(self, order):\n        self.get_logger().info('Waiting for action server...')\n        self._action_client.wait_for_server()\n\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        self.get_logger().info(f'Sending goal request... order={order}')\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        self.goal_handle = future.result()\n        if not self.goal_handle.accepted:\n            self.get_logger().error('Goal rejected :(')\n            rclpy.shutdown()\n            return\n\n        self.get_logger().info('Goal accepted :)')\n        # Start a timer to cancel the goal after some feedback\n        self.cancellation_timer = self.create_timer(3.0, self.cancel_goal_timer_callback) # Cancel after 3 seconds\n\n        self._get_result_future = self.goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def get_result_callback(self, future):\n        status = future.result().status\n        if status == GoalStatus.STATUS_SUCCEEDED:\n            result = future.result().result\n            self.get_logger().info(f'Goal succeeded! Result: {list(result.sequence)}')\n        elif status == GoalStatus.STATUS_CANCELED:\n            self.get_logger().info('Goal was successfully canceled.')\n        else:\n            self.get_logger().warn(f'Goal finished with status: {status}')\n\n        if self.cancellation_timer:\n            self.cancellation_timer.cancel()\n        rclpy.shutdown()\n\n    def feedback_callback(self, feedback_msg):\n        self.get_logger().info(f'Received feedback: {list(feedback_msg.partial_sequence)}')\n        self.feedback_count += 1\n        # Optional: Cancel after N feedback messages\n        # if self.feedback_count >= 3 and self.goal_handle and not self.goal_handle.is_status_done():\n        #     self.get_logger().info('Cancelling goal after sufficient feedback.')\n        #     cancel_future = self.goal_handle.cancel_goal_async()\n        #     cancel_future.add_done_callback(\n        #         lambda future: self.get_logger().info(f'Goal cancellation request sent: {future.result().return_code}')\n        #     )\n\n    def cancel_goal_timer_callback(self):\n        if self.goal_handle and not self.goal_handle.is_status_done():\n            self.get_logger().info('Timer triggered: Cancelling goal.')\n            cancel_future = self.goal_handle.cancel_goal_async()\n            cancel_future.add_done_callback(\n                lambda future: self.get_logger().info(f'Goal cancellation request sent: {future.result().return_code}')\n            )\n        else:\n            if self.cancellation_timer:\n                self.cancellation_timer.cancel() # Stop the timer if goal is already done\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    action_client = FibonacciActionClient()\n    action_client.send_goal(20) # Request Fibonacci sequence up to order 20\n    rclpy.spin(action_client)\n\nif __name__ == '__main__':\n    main()\n"})}),(0,r.jsxs)(n.p,{children:["Run with: ",(0,r.jsx)(n.code,{children:"ros2 run my_robot_pkg fibonacci_server"})," (in one terminal) and ",(0,r.jsx)(n.code,{children:"ros2 run my_robot_pkg fibonacci_client"})," (in another).\nObserve the client sending cancellation and the server responding to it."]})]}),"\n",(0,r.jsx)(n.h2,{id:"further-reading-and-official-resources",children:"Further Reading and Official Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ROS 2 Documentation"}),": The official source for all things ROS 2. Essential for in-depth understanding.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts.html",children:"ROS 2 Concepts"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Nodes/Understanding-ROS2-Nodes.html",children:"Understanding ROS 2 Nodes"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Topics/Understanding-ROS2-Topics.html",children:"Understanding ROS 2 Topics"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Services/Understanding-ROS2-Services.html",children:"Understanding ROS 2 Services"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Actions/Understanding-ROS2-Actions.html",children:"Understanding ROS 2 Actions"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"rclpy"})," Documentation"]}),": Python client library specifics.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/p/rclpy/index.html",children:"rclpy documentation"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"DDS (Data Distribution Service)"}),": The underlying communication standard.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.omg.org/dds/",children:"OMG DDS Portal"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Message and Service Definitions"}),": How to define your own custom messages and services.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Custom-ROS2-Interfaces.html",children:"Creating Custom ROS 2 Msg and Srv (Python)"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Mastering ROS 2 nodes, topics, services, and actions provides the foundational building blocks for complex, modular, and robust robotic applications. This understanding is critical for humanoid robotics, where intricate control and feedback loops are paramount for natural and intelligent behaviors in the physical world."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/docs/learning-outcomes",children:(0,r.jsx)(n.strong,{children:"\u2190 Previous: Learning Outcomes"})})," | ",(0,r.jsx)(n.a,{href:"/docs/module-1/bridging-python-agents-to-ros2",children:(0,r.jsx)(n.strong,{children:"Next: Bridging Python Agents to ROS 2 \u2192"})})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);